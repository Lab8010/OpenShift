このページでは、Red Hatが提供するhttpdイメージを使用し、Deploymentリソースを展開後、動作確認などに使用するコマンドを試すためのサンプルコマンドを紹介しています。

#プロジェクト名 ocp-learningを作成する。
oc new-project ocp-learning

#Deployment名 my1stdeployとして、Red Hatが提供するhttpd-24イメージを使用したデプロイメントとして展開されるPodを起動する。
oc create deployment my1stdeploy --image registry.access.redhat.com/ubi9/httpd-24

【上記コマンドの出力例】
#deployment.apps/my1stdeploy created

#Podの起動している様子を確認するコマンド(上記のコマンドから1分後くらいに確認すると)
oc get pods

【上記コマンドの出力例】
#NAME                           READY   STATUS    RESTARTS   AGE
#my1stdeploy-6cb9b94896-r5zdb   1/1     Running   0          5m27s

#サービス、DeploymentConfig、および BuildConfig などの現在のプロジェクトについての情報を表示するためのコマンド
oc status

【上記コマンドの出力例】
In project ocp-learning on server https://api.crc.testing:6443

http://my1stpod-ocp-learning.apps-crc.testing to pod port 8080 (svc/my1stpod)
  pod/my1stpod runs registry.access.redhat.com/ubi9/httpd-24

deployment/my1stdeploy deploys registry.access.redhat.com/ubi9/httpd-24
  deployment #1 running for 4 minutes - 1 pod

#上記で作成されたDeployment名 my1stdeployに対するサービスを作成するコマンド(使用しているコンテナはポート番号8080を使用してWebページを提供し、フロントエンド側のポート番号80に80に関連付けWebページを公開しているイメージ)
oc expose deployment/my1stdeploy --name svc-my1stdeploy --port 80 --target-port 8080

【上記コマンドの出力例】
service/svc-my1stdeploy exposed

#上記のコマンドで作成されたサービスを確認する
oc get services                                                                     

【上記コマンドの出力例】
#NAME              TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
#svc-my1stdeploy   ClusterIP   10.217.5.160   <none>        80/TCP    5m6s

#上記で作成されたサービス名 svc-my1stdeployに対するルートを作成するコマンド
oc expose service/svc-my1stdeploy --name route-my1stdeploy

【上記コマンドの出力例】
#route.route.openshift.io/route-my1stdeploy exposed

#上記のコマンドで作成されたルートを確認する
oc get route

【上記コマンドの出力例】
#NAME                HOST/PORT                                         PATH   SERVICES          PORT   TERMINATION   WILDCARD
#route-my1stdeploy   route-my1stdeploy-ocp-learning.apps-crc.testing          svc-my1stdeploy   8080                 None

#現在実行されているDeployment名 my1stdeployのPodのレプリカ数を1から2に変更する
oc scale deployment my1stdeploy --replicas 2

【上記コマンドの出力例】
deployment.apps/my1stdeploy scaled

#上記でスケールされたDeploymentのPodの数を確認するコマンド(Podの数が1から2になっています)
oc get deployment

【上記コマンドの出力例】
#NAME          READY   UP-TO-DATE   AVAILABLE   AGE
#my1stdeploy   2/2     2            2           43m
deployment.apps/my1stdeploy scaled

#上記でスケールされたDeploymentのPodを確認する(1回目)
oc get pods

【上記コマンドの出力例】
#NAME                           READY   STATUS    RESTARTS   AGE
#my1stdeploy-6cb9b94896-9wcs7   1/1     Running   0          6m47s　←　AGEが6分強、新しく展開された2つ目のPod
#my1stdeploy-6cb9b94896-r5zdb   1/1     Running   0          50m　　←　AGEが50分、元から動いていた1つ目のPod

#現在実行されているDeployment名 my1stdeployのPodのレプリカ数を2から5に変更する
oc scale deployment my1stdeploy --replicas 5

【上記コマンドの出力例】
deployment.apps/my1stdeploy scaled ←　レプリカ数を1から2にしたときと同じ出力

#上記でスケールされたDeploymentのPodを確認する(2回目)
oc get pods

【上記コマンドの出力例】
NAME                           READY   STATUS    RESTARTS   AGE
my1stdeploy-6cb9b94896-42xhk   1/1     Running   0          10s
my1stdeploy-6cb9b94896-9wcs7   1/1     Running   0          37m
my1stdeploy-6cb9b94896-kspd5   1/1     Running   0          10s
my1stdeploy-6cb9b94896-r5zdb   1/1     Running   0          80m
my1stdeploy-6cb9b94896-smsfb   1/1     Running   0          10s

#5つのPodによるDeployment構成の場合のエンドポイントを確認する(ENDPOINTSには5つのPod IPが表示されるが、幅が足りず省略されている)
oc get endpoints                            
NAME              ENDPOINTS                                                           AGE
svc-my1stdeploy   10.217.0.101:8080,10.217.0.118:8080,10.217.0.119:8080 + 2 more...   60m

#上記のルートにより公開されたPod(Pod名 my1stdeploy)にWebアクセスができるかを試す。(firefoxなどのブラウザでアクセスを試しても良い)
curl route-my1stdeploy-ocp-learning.apps-crc.testing

【上記コマンドの出力事例】(以下はコンテナイメージ内のWebページ) 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>Test Page for the HTTP Server on Red Hat Enterprise Linux</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<style type="text/css">
			/*<![CDATA[*/
